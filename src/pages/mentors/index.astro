---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";

const mentors = await getCollection("mentors");

// ✅ Sort mentors alphabetically by name (safe even if name missing)
const sorted = mentors.sort((a, b) => {
  const an = (a.data?.name ?? "").toLowerCase();
  const bn = (b.data?.name ?? "").toLowerCase();
  return an.localeCompare(bn);
});
---

<BaseLayout title="Mentors | The Capstone Program">
  <!-- Premium Hero -->
  <section class="relative bg-capBlack text-white overflow-hidden">
    <div class="pointer-events-none absolute -top-40 -left-40 h-[480px] w-[480px] rounded-full bg-capBlue/25 blur-3xl"></div>
    <div class="pointer-events-none absolute -bottom-44 -right-40 h-[520px] w-[520px] rounded-full bg-capBlue/15 blur-3xl"></div>

    <div class="mx-auto max-w-6xl px-4 pt-16 pb-20 md:pt-20 md:pb-24">
      <p class="text-[11px] font-semibold tracking-[0.22em] text-white/60 uppercase">
        Mentors
      </p>

      <h1 class="mt-4 text-4xl font-semibold leading-tight md:text-6xl md:leading-tight">
        Featured mentors
      </h1>

      <p class="mt-5 max-w-3xl text-sm md:text-base text-white/80 leading-relaxed">
        Mentors are added from the Admin panel. This page updates automatically when you publish.
      </p>
    </div>
  </section>

  <!-- Mentors Grid -->
  <section class="mx-auto max-w-6xl px-4 py-14 md:py-20">
    {sorted.length > 0 ? (
      <div class="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
        {sorted.map((m) => {
          const name = m.data?.name ?? "Mentor";
          const firstLetter = name.slice(0, 1).toUpperCase();

          const tags =
            typeof m.data.tags === "string" && m.data.tags.trim().length > 0
              ? m.data.tags.split(",").map((t) => t.trim()).filter(Boolean)
              : [];

          return (
            <article class="rounded-3xl border border-black/10 bg-white p-6 shadow-sm hover:shadow-md transition">
              <div class="flex items-start gap-4">
                <div class="h-12 w-12 rounded-2xl bg-capBlue/10 flex items-center justify-center">
                  <span class="text-sm font-bold text-capBlue">{firstLetter}</span>
                </div>

                <div class="flex-1">
                  <h3 class="text-lg font-semibold text-capBlack">{name}</h3>

                  {(m.data.role || m.data.org) && (
                    <p class="mt-1 text-sm text-capText/70">
                      {m.data.role ? m.data.role : ""}
                      {m.data.role && m.data.org ? " · " : ""}
                      {m.data.org ? m.data.org : ""}
                    </p>
                  )}
                </div>
              </div>

              {tags.length > 0 && (
                <div class="mt-5 flex flex-wrap gap-2">
                  {tags.slice(0, 6).map((t) => (
                    <span class="rounded-full bg-black/5 px-3 py-1 text-[11px] font-semibold text-black/70">
                      {t}
                    </span>
                  ))}
                </div>
              )}

              <div class="mt-6 flex items-center justify-between">
                <span class="text-xs font-semibold text-capText/60">
                  Capstone Mentor
                </span>

                {m.data.linkedin ? (
                  <a
                    href={m.data.linkedin}
                    target="_blank"
                    rel="noopener noreferrer"
                    class="rounded-xl border border-black/10 bg-white px-4 py-2 text-xs font-semibold hover:bg-black/5"
                  >
                    LinkedIn
                  </a>
                ) : (
                  <span class="text-xs text-black/30">No LinkedIn</span>
                )}
              </div>
            </article>
          );
        })}
      </div>
    ) : (
      <div class="rounded-3xl border border-black/10 bg-white p-10 text-center">
        <h2 class="text-xl font-semibold">No mentors published yet</h2>
        <p class="mt-2 text-sm text-black/60">
          Go to <span class="font-semibold">/admin</span> and publish your first mentor.
        </p>
      </div>
    )}
  </section>
</BaseLayout>

